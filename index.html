<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>MinistryOS Pro</title>
    
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#0f172a">

    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <style>
        body { background-color: #0f172a; color: white; -webkit-tap-highlight-color: transparent; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .safe-pb { padding-bottom: env(safe-area-inset-bottom); }
        .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px; }
        .cal-day { min-height: 50px; border-radius: 8px; position: relative; font-size: 11px; padding: 4px; display: flex; flex-direction: column; align-items: center; cursor: pointer; background: #111827; border: 1px solid #1f2937; }
        .cal-day:active { background: #1e293b; }
        .current-day { border: 2px solid #3b82f6; background: rgba(59, 130, 246, 0.1); }
        .dot { width: 6px; height: 6px; border-radius: 50%; margin-bottom: 2px; }
        input, textarea, select { background: #1e293b; border: 1px solid #334155; color: white; border-radius: 8px; padding: 10px; width: 100%; outline: none; }
        label { font-size: 11px; text-transform: uppercase; color: #94a3b8; font-weight: bold; margin-bottom: 4px; display: block; }
        .listening { border-color: #ef4444 !important; box-shadow: 0 0 8px #ef4444; }
    </style>
</head>
<body>

    <div id="root" class="h-screen w-screen bg-slate-900"></div>

    <script type="text/babel">
        // --- 1. FIREBASE CONFIG ---
        const firebaseConfig = {
          apiKey: "AIzaSyCWTjZ5P-cvfL3bgFOrl53qRQEfWP35ThE",
          authDomain: "crossyth-dashboard.firebaseapp.com",
          projectId: "crossyth-dashboard",
          storageBucket: "crossyth-dashboard.firebasestorage.app",
          messagingSenderId: "999386499044",
          appId: "1:999386499044:web:49e4bc10c133b4c20f29f1"
        };
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // --- 2. ICONS ---
        const Icons = {
            Calendar: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>,
            MapPin: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>,
            Mic: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" y1="19" x2="12" y2="23"/><line x1="8" y1="23" x2="16" y2="23"/></svg>,
            Users: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>,
            Book: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>,
            Plus: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>,
            ChevronLeft: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="15 18 9 12 15 6"/></svg>,
            ChevronRight: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="9 18 15 12 9 6"/></svg>,
            ChevronDown: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="6 9 12 15 18 9"/></svg>,
            CheckSquare: () => <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="9 11 12 14 22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></svg>,
            Trash: () => <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>,
            Edit: () => <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>,
            MicOn: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="red" stroke="red" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" y1="19" x2="12" y2="23"/><line x1="8" y1="23" x2="16" y2="23"/></svg>
        };

        // --- 3. SPEECH TOOL ---
        const DictationInput = ({ value, onChange, placeholder, isTextArea = false }) => {
            const [isListening, setIsListening] = React.useState(false);
            const toggleListening = () => {
                if (!('webkitSpeechRecognition' in window)) return alert("Speech recognition not supported.");
                const recognition = new window.webkitSpeechRecognition();
                recognition.onstart = () => setIsListening(true);
                recognition.onend = () => setIsListening(false);
                recognition.onresult = (event) => onChange(value ? value + " " + event.results[0][0].transcript : event.results[0][0].transcript);
                recognition.start();
            };
            return (
                <div className="relative">
                    {isTextArea ? 
                        <textarea value={value} onChange={e=>onChange(e.target.value)} placeholder={placeholder} className={isListening ? 'listening' : ''} rows="3" /> :
                        <input value={value} onChange={e=>onChange(e.target.value)} placeholder={placeholder} className={isListening ? 'listening' : ''} />
                    }
                    <button onClick={toggleListening} className="absolute right-2 top-2 p-1.5 bg-slate-800 rounded-full">{isListening ? <Icons.MicOn/> : <Icons.Mic/>}</button>
                </div>
            );
        };

        // --- 4. APP ---
        function App() {
            const [tab, setTab] = React.useState('calendar');
            return (
                <div className="flex flex-col h-full w-full bg-slate-900 text-white safe-pb">
                    <div className="h-16 flex items-center justify-between px-4 border-b border-slate-800 shrink-0">
                        <span className="font-bold text-lg text-white">MinistryOS Pro</span>
                        <div className="w-9 h-9 bg-slate-800 rounded-full border border-slate-700 flex items-center justify-center font-bold text-slate-400">PC</div>
                    </div>
                    <div className="flex-1 overflow-y-auto bg-slate-950">
                        {tab === 'calendar' && <CalendarView />}
                        {tab === 'benson' && <GenericManager category="Benson" color="red" />}
                        {tab === 'prod' && <ProductionManager />}
                        {tab === 'crossyth' && <UnifiedManager category="CrossYTH" color="blue" />}
                        {tab === 'crosslink' && <UnifiedManager category="CrossLink" color="purple" />}
                    </div>
                    <div className="h-20 bg-slate-900 border-t border-slate-800 flex justify-around items-center pt-2 safe-pb">
                        <NavBtn id="calendar" icon={Icons.Calendar} label="Calendar" active={tab} set={setTab} />
                        <NavBtn id="benson" icon={Icons.MapPin} label="Benson" active={tab} set={setTab} />
                        <NavBtn id="prod" icon={Icons.Mic} label="Prod" active={tab} set={setTab} />
                        <NavBtn id="crossyth" icon={Icons.Users} label="YTH" active={tab} set={setTab} />
                        <NavBtn id="crosslink" icon={Icons.Book} label="Link" active={tab} set={setTab} />
                    </div>
                </div>
            );
        }

        // --- 5. CALENDAR (CLICKABLE) ---
        function CalendarView() {
            const [date, setDate] = React.useState(new Date());
            const [items, setItems] = React.useState([]);
            const [selectedDay, setSelectedDay] = React.useState(null);

            React.useEffect(() => {
                const unsub = db.collection('projects').onSnapshot(snap => setItems(snap.docs.map(d => d.data())));
                return () => unsub();
            }, []);

            const daysInMonth = new Date(date.getFullYear(), date.getMonth() + 1, 0).getDate();
            const firstDay = new Date(date.getFullYear(), date.getMonth(), 1).getDay();
            const monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];

            const getItemsForDay = (day) => {
                const ds = new Date(date.getFullYear(), date.getMonth(), day).toISOString().split('T')[0];
                return items.filter(i => i.dueDate === ds || i.date === ds);
            };

            const getColor = (cat, status) => {
                if(status === 'Pending') return 'bg-slate-600';
                if(cat === 'Benson') return 'bg-red-500';
                if(cat === 'Production') return 'bg-yellow-500';
                if(cat === 'CrossYTH') return 'bg-blue-500';
                return 'bg-purple-500';
            };

            return (
                <div className="p-4">
                    <div className="flex justify-between items-center mb-4">
                        <button onClick={() => setDate(new Date(date.setMonth(date.getMonth()-1)))} className="p-2 bg-slate-800 rounded-lg"><Icons.ChevronLeft/></button>
                        <h2 className="text-xl font-bold">{monthNames[date.getMonth()]} {date.getFullYear()}</h2>
                        <button onClick={() => setDate(new Date(date.setMonth(date.getMonth()+1)))} className="p-2 bg-slate-800 rounded-lg"><Icons.ChevronRight/></button>
                    </div>
                    <div className="cal-grid mb-6">
                        {['S','M','T','W','T','F','S'].map(d => <div key={d} className="text-center text-slate-600 text-[10px] font-bold py-1">{d}</div>)}
                        {Array(firstDay).fill(null).map((_,i) => <div key={`e-${i}`} />)}
                        {Array(daysInMonth).fill(null).map((_,i) => {
                            const day = i + 1;
                            const dayItems = getItemsForDay(day);
                            const isToday = new Date().toDateString() === new Date(date.getFullYear(), date.getMonth(), day).toDateString();
                            return (
                                <div key={i} onClick={()=>setSelectedDay(day)} className={`cal-day ${isToday ? 'current-day' : ''} ${selectedDay===day?'border-blue-500':''}`}>
                                    <span className="text-slate-400">{day}</span>
                                    <div className="flex flex-wrap gap-0.5 justify-center mt-1">
                                        {dayItems.map((it, idx) => <div key={idx} className={`dot ${getColor(it.category, it.status)}`} />)}
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                    {selectedDay && (
                        <div className="bg-slate-900 rounded-xl p-4 border border-slate-800">
                            <h3 className="font-bold text-blue-400 mb-2">{monthNames[date.getMonth()]} {selectedDay} Schedule</h3>
                            {getItemsForDay(selectedDay).length === 0 ? <p className="text-slate-500 text-sm">No items scheduled.</p> :
                                getItemsForDay(selectedDay).map((it, idx) => (
                                    <div key={idx} className="flex items-center gap-3 mb-2 p-2 bg-slate-950 rounded-lg">
                                        <div className={`w-2 h-2 rounded-full ${getColor(it.category, it.status)}`} />
                                        <div className="text-sm font-bold">{it.title} <span className="text-[10px] text-slate-500 font-normal">({it.category})</span></div>
                                    </div>
                                ))
                            }
                        </div>
                    )}
                </div>
            );
        }

        // --- WORKFLOW HELPERS ---
        const generateSmartWorkflow = (title, desc, dueDate) => {
            const tasks = [];
            const due = new Date(dueDate);
            const calc = (days) => {
                const d = new Date(due); d.setDate(d.getDate() - days); return d.toISOString().split('T')[0];
            };
            tasks.push({ txt: "Final Dry Run", date: calc(14), done: false, isTarget: true });
            tasks.push({ txt: "Equipment Prep", date: calc(7), done: false });
            tasks.push({ txt: "Team Briefing", date: calc(3), done: false });
            return tasks;
        };

        // --- MANAGERS ---
        function GenericManager({ category, color }) {
            const [sub, setSub] = React.useState('Projects');
            return (
                <div className="p-4 flex flex-col h-full">
                    <div className="flex bg-slate-900 p-1 rounded-xl mb-4 shrink-0">
                        {['Projects', 'Events', 'Outreach'].map(t => (
                            <button key={t} onClick={()=>setSub(t)} className={`flex-1 py-2 text-xs font-bold rounded-lg ${sub===t?'bg-slate-700 text-white':'text-slate-500'}`}>{t}</button>
                        ))}
                    </div>
                    <WorkflowSystem category={category} subCategory={sub} color={color} />
                </div>
            );
        }

        function UnifiedManager({ category, color }) {
            const [sub, setSub] = React.useState('Series');
            return (
                <div className="p-4 flex flex-col h-full">
                    <div className="flex bg-slate-900 p-1 rounded-xl mb-4 shrink-0 overflow-x-auto">
                        {['Series', 'Projects', 'Events', 'Outreach'].map(t => (
                            <button key={t} onClick={()=>setSub(t)} className={`flex-1 py-2 px-3 text-xs font-bold rounded-lg whitespace-nowrap ${sub===t?'bg-slate-700 text-white':'text-slate-500'}`}>{t}</button>
                        ))}
                    </div>
                    {sub==='Series' ? <SeriesManager category={category} color={color} /> : <WorkflowSystem category={category} subCategory={sub} color={color} />}
                </div>
            );
        }

        function WorkflowSystem({ category, subCategory, color }) {
            const [mode, setMode] = React.useState('Ideas');
            const [items, setItems] = React.useState([]);
            const [isAdd, setIsAdd] = React.useState(false);
            const [t, setT] = React.useState('');
            const [d, setD] = React.useState('');
            const [dt, setDt] = React.useState('');

            React.useEffect(() => {
                const unsub = db.collection('projects').where('category','==',category).where('subCategory','==',subCategory).where('status','==',mode==='Ideas'?'Pending':'Approved').onSnapshot(snap=>setItems(snap.docs.map(d=>({id:d.id,...d.data()}))));
                return () => unsub();
            }, [category, subCategory, mode]);

            const save = async () => {
                if(!t || !dt) return alert("Need Title/Date");
                await db.collection('projects').add({category,subCategory,title:t,desc:d,dueDate:dt,status:'Pending',tasks:[]});
                setIsAdd(false); setT(''); setD(''); setDt('');
            };

            const approve = async (it) => {
                await db.collection('projects').doc(it.id).update({status:'Approved', tasks: generateSmartWorkflow(it.title,it.desc,it.dueDate)});
            };

            return (
                <div className="flex-1 flex flex-col">
                    <div className="flex justify-between mb-4">
                        <div className="flex gap-4">
                            <button onClick={()=>setMode('Ideas')} className={`text-sm font-bold ${mode==='Ideas'?'border-b-2 text-white':'text-slate-500'}`}>IDEAS</button>
                            <button onClick={()=>setMode('Active')} className={`text-sm font-bold ${mode==='Active'?'border-b-2 text-white':'text-slate-500'}`}>ACTIVE</button>
                        </div>
                        {mode==='Ideas' && <button onClick={()=>setIsAdd(true)} className={`text-${color}-500`}><Icons.Plus/></button>}
                    </div>
                    {isAdd && (
                        <div className="bg-slate-800 p-4 rounded-xl mb-4 space-y-3">
                            <div><label>Title</label><DictationInput value={t} onChange={setT} /></div>
                            <div><label>Description</label><DictationInput value={d} onChange={setD} isTextArea /></div>
                            <div><label>Date</label><input type="date" value={dt} onChange={e=>setDt(e.target.value)} /></div>
                            <div className="flex gap-2 pt-2"><button onClick={save} className={`flex-1 bg-${color}-600 py-2 rounded font-bold`}>Save</button><button onClick={()=>setIsAdd(false)} className="px-4 py-2 bg-slate-700 rounded">X</button></div>
                        </div>
                    )}
                    <div className="space-y-3 pb-20">
                        {items.map(it => <WorkflowCard key={it.id} it={it} mode={mode} onApprove={()=>approve(it)} color={color} />)}
                    </div>
                </div>
            );
        }

        function WorkflowCard({ it, mode, onApprove, color }) {
            const [open, setOpen] = React.useState(false);
            return (
                <div className="bg-slate-900 border border-slate-800 rounded-xl overflow-hidden">
                    <div className="p-4" onClick={()=>mode==='Active' && setOpen(!open)}>
                        <div className="flex justify-between items-start">
                            <div className="flex-1">
                                <h3 className="font-bold text-white">{it.title}</h3>
                                <p className="text-xs text-slate-400 mt-1">{it.desc}</p>
                                <div className="text-[10px] text-slate-500 mt-2">Due: {it.dueDate}</div>
                            </div>
                            {mode==='Ideas' ? <button onClick={(e)=>{e.stopPropagation();onApprove();}} className="bg-emerald-600 text-[10px] font-bold px-3 py-1.5 rounded">APPROVE</button> : <div className={`w-2 h-2 rounded-full bg-${color}-500 shadow-[0_0_8px_currentColor]`} />}
                        </div>
                    </div>
                    {open && mode==='Active' && (
                        <div className="bg-slate-950 p-4 border-t border-slate-800 space-y-3">
                            {it.tasks && it.tasks.map((tk,i) => (
                                <div key={i} className="flex gap-3 text-xs items-center">
                                    <div className="w-4 h-4 rounded border border-slate-600 shrink-0" />
                                    <div className="flex-1"><div className={tk.isTarget?'text-emerald-400 font-bold':''}>{tk.txt}</div><div className="text-[9px] text-slate-500">Target: {tk.date}</div></div>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        }

        // --- SERIES & SERMONS ---
        function SeriesManager({ category, color }) {
            const [list, setList] = React.useState([]);
            const [add, setAdd] = React.useState(false);
            const [exp, setExp] = React.useState(null);
            const [st, setSt] = React.useState('');
            const [sw, setSw] = React.useState('');

            React.useEffect(() => {
                const unsub = db.collection('series').where('category','==',category).onSnapshot(sn=>setList(sn.docs.map(d=>({id:d.id,...d.data()}))));
                return () => unsub();
            }, [category]);

            const save = async () => {
                await db.collection('series').add({category,title:st,weeks:sw});
                setAdd(false); setSt(''); setSw('');
            };

            return (
                <div className="flex-1 overflow-y-auto pb-20">
                    <div className="flex justify-between items-center mb-4"><h3 className="text-xs font-bold text-slate-500">SERIES</h3><button onClick={()=>setAdd(true)} className={`text-${color}-500`}><Icons.Plus/></button></div>
                    {add && <div className="bg-slate-800 p-4 rounded-xl mb-4 space-y-2"><input placeholder="Title" value={st} onChange={e=>setSt(e.target.value)} /><input placeholder="Weeks" type="number" value={sw} onChange={e=>setSw(e.target.value)} /><button onClick={save} className={`w-full py-2 rounded bg-${color}-600 font-bold text-sm`}>Create</button></div>}
                    <div className="space-y-3">
                        {list.map(s => (
                            <div key={s.id} className="bg-slate-900 border border-slate-800 rounded-xl overflow-hidden">
                                <div className="p-4 flex justify-between items-center" onClick={()=>setExp(exp===s.id?null:s.id)}><div><div className="font-bold">{s.title}</div><div className="text-xs text-slate-500">{s.weeks} Weeks</div></div><Icons.ChevronDown/></div>
                                {exp===s.id && <SermonList seriesId={s.id} color={color} />}
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        function SermonList({ seriesId, color }) {
            const [sermons, setSermons] = React.useState([]);
            const [edit, setEdit] = React.useState(null);
            const [fd, setFd] = React.useState({title:'',speaker:'',scripture:'',notes:''});

            React.useEffect(() => {
                const unsub = db.collection('sermons').where('seriesId','==',seriesId).onSnapshot(sn=>setSermons(sn.docs.map(d=>({id:d.id,...d.data()}))));
                return () => unsub();
            }, [seriesId]);

            const save = async () => {
                if(edit==='new') await db.collection('sermons').add({...fd, seriesId, weekNum: sermons.length+1});
                else await db.collection('sermons').doc(edit).update(fd);
                setEdit(null);
            };

            return (
                <div className="bg-slate-950 p-4 border-t border-slate-800">
                    {sermons.map(sm => (
                        <div key={sm.id} className="mb-4 pb-4 border-b border-slate-800 last:border-0 relative">
                            {edit===sm.id ? <div className="space-y-2"><DictationInput value={fd.title} onChange={v=>setFd({...fd,title:v})} /><textarea value={fd.notes} onChange={e=>setFd({...fd,notes:e.target.value})} className="text-xs bg-slate-800 p-2 w-full" rows="3" /><button onClick={save} className="w-full bg-blue-600 py-1 rounded text-xs font-bold">Save</button></div> : 
                            <div onClick={()=>{setFd(sm);setEdit(sm.id)}}><div className="flex justify-between text-[10px] font-bold text-blue-400"><span>Week {sm.weekNum}</span><span>{sm.speaker}</span></div><div className="font-bold text-sm">{sm.title}</div><div className="text-[10px] text-slate-500 italic">{sm.scripture}</div><div className="text-[10px] text-slate-400 mt-1 whitespace-pre-wrap">{sm.notes}</div></div>}
                        </div>
                    ))}
                    {edit==='new' ? <div className="space-y-2"><DictationInput value={fd.title} onChange={v=>setFd({...fd,title:v})} placeholder="Sermon Title" /><DictationInput value={fd.notes} onChange={v=>setFd({...fd,notes:v})} placeholder="Notes" isTextArea /><button onClick={save} className="w-full bg-blue-600 py-2 rounded font-bold text-xs">Save Sermon</button></div> : <button onClick={()=>{setFd({title:'',speaker:'',scripture:'',notes:''});setEdit('new')}} className="w-full py-2 border border-dashed border-slate-700 text-xs text-slate-500 rounded">+ Add Week</button>}
                </div>
            );
        }

        // --- PRODUCTION ---
        function ProductionManager() {
            const [sub, setSub] = React.useState('Weekly');
            const [tasks, setTasks] = React.useState([]);
            const [add, setAdd] = React.useState(false);
            const [nm, setNm] = React.useState('');

            React.useEffect(() => {
                const unsub = db.collection('prod_weekly').onSnapshot(sn=>setTasks(sn.docs.map(d=>({id:d.id,...d.data()}))));
                return () => unsub();
            }, []);

            return (
                <div className="p-4 h-full flex flex-col">
                    <div className="flex bg-slate-900 p-1 rounded-xl mb-4 shrink-0"><button onClick={()=>setSub('Weekly')} className={`flex-1 py-2 text-xs font-bold rounded-lg ${sub==='Weekly'?'bg-slate-700 text-white':'text-slate-500'}`}>Weekly</button><button onClick={()=>setSub('Projects')} className={`flex-1 py-2 text-xs font-bold rounded-lg ${sub==='Projects'?'bg-slate-700 text-white':'text-slate-500'}`}>Projects</button></div>
                    {sub==='Weekly' ? <div className="space-y-4">{tasks.map(t => <div key={t.id} className="bg-slate-900 p-4 rounded-xl border border-slate-800"><div className="flex justify-between items-center border-b border-slate-800 pb-2 mb-2"><span className="font-bold">{t.title}</span><button onClick={()=>db.collection('prod_weekly').doc(t.id).delete()}><Icons.Trash/></button></div><div className="space-y-1">{(t.subtasks||[]).map((s,i)=><div key={i} className="flex gap-2 text-xs text-slate-400"><Icons.CheckSquare/> {s.txt}</div>)}<button onClick={()=>{const tx=prompt("Subtask:");if(tx)db.collection('prod_weekly').doc(t.id).update({subtasks:[...(t.subtasks||[]),{txt:tx,done:false}]})}} className="text-[10px] text-blue-500 mt-2">+ Add Subtask</button></div></div>)}<button onClick={()=>{const t=prompt("Checklist Name:");if(t)db.collection('prod_weekly').add({title:t,subtasks:[]})}} className="w-full py-3 border border-dashed border-slate-700 rounded-xl text-slate-500 text-xs">+ New Weekly Checklist</button></div> : <WorkflowSystem category="Production" subCategory="Projects" color="yellow" />}
                </div>
            );
        }

        const NavBtn = ({ id, icon: Icon, label, active, set }) => (
            <button onClick={()=>set(id)} className={`flex flex-col items-center gap-1 transition-all ${active===id?'text-blue-400 scale-110':'text-slate-500'}`}><Icon/><span className="text-[10px] font-bold">{label}</span></button>
        );

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
