<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>CrossYTH Dashboard</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#0f172a">

    <script src="https://cdn.tailwindcss.com"></script>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <style>
        body { background-color: #0f172a; color: white; font-family: sans-serif; -webkit-tap-highlight-color: transparent; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .safe-pb { padding-bottom: env(safe-area-inset-bottom); }
    </style>
</head>
<body>

    <div id="root" class="h-screen w-screen flex flex-col items-center justify-center">
        <div class="animate-pulse text-blue-400 font-bold tracking-widest text-xl">LOADING CROSSYTH...</div>
        <div id="debug-log" class="mt-4 text-xs text-red-400 font-mono max-w-xs text-center"></div>
    </div>

    <script type="text/babel">
        // --- ERROR TRAP (Prints errors to screen so we can see them) ---
        window.onerror = function(msg, url, line) {
            document.getElementById('debug-log').innerHTML += `<br/>Error: ${msg} (Line ${line})`;
            return false;
        };

        try {
            // --- 1. FIREBASE SETUP (Compat Mode) ---
            const firebaseConfig = {
                apiKey: "AIzaSyCWTjZ5P-cvfL3bgFOrl53qRQEfWP35ThE",
                authDomain: "crossyth-dashboard.firebaseapp.com",
                projectId: "crossyth-dashboard",
                storageBucket: "crossyth-dashboard.firebasestorage.app",
                messagingSenderId: "999386499044",
                appId: "1:999386499044:web:49e4bc10c133b4c20f29f1",
                measurementId: "G-YX6RZ0QCKM"
            };

            // Initialize safely
            if (!firebase.apps.length) {
                firebase.initializeApp(firebaseConfig);
            }
            const db = firebase.firestore();

            // --- 2. ICONS (Simple SVGs) ---
            const IconMenu = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="4" y1="12" x2="20" y2="12"/><line x1="4" y1="6" x2="20" y2="6"/><line x1="4" y1="18" x2="20" y2="18"/></svg>;
            const IconX = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>;
            const IconHome = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>;
            const IconBook = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>;
            const IconPlus = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="16"/><line x1="8" y1="12" x2="16" y2="12"/></svg>;

            // --- 3. MAIN APP ---
            function App() {
                const [tab, setTab] = React.useState('dashboard');
                const [menuOpen, setMenuOpen] = React.useState(false);

                // Simple Router
                const renderContent = () => {
                    if (tab === 'dashboard') return <DashboardView />;
                    if (tab === 'sermons') return <SermonManager />;
                    return <DashboardView />;
                };

                return (
                    <div className="flex flex-col h-screen w-full bg-slate-900 text-white overflow-hidden">
                        {/* HEADER */}
                        <div className="h-16 border-b border-slate-800 flex items-center justify-between px-4 shrink-0 bg-slate-900 z-20">
                            <div className="font-bold text-xl tracking-tight text-blue-500">CrossYTH</div>
                            <button onClick={() => setMenuOpen(!menuOpen)} className="p-2 active:bg-slate-800 rounded text-slate-300">
                                {menuOpen ? <IconX /> : <IconMenu />}
                            </button>
                        </div>

                        {/* MENU OVERLAY */}
                        {menuOpen && (
                            <div className="absolute top-16 left-0 w-full h-full bg-slate-900/95 z-50 p-6 flex flex-col gap-4 animate-fade-in">
                                <button onClick={() => {setTab('dashboard'); setMenuOpen(false);}} className={`flex items-center gap-4 p-4 rounded-xl text-lg font-medium ${tab==='dashboard'?'bg-blue-600 text-white':'text-slate-400'}`}>
                                    <IconHome /> Dashboard
                                </button>
                                <button onClick={() => {setTab('sermons'); setMenuOpen(false);}} className={`flex items-center gap-4 p-4 rounded-xl text-lg font-medium ${tab==='sermons'?'bg-blue-600 text-white':'text-slate-400'}`}>
                                    <IconBook /> Sermons
                                </button>
                            </div>
                        )}

                        {/* MAIN CONTENT */}
                        <div className="flex-1 overflow-y-auto bg-slate-50 text-slate-900 relative safe-pb">
                            {renderContent()}
                        </div>
                    </div>
                );
            }

            // --- VIEW: DASHBOARD ---
            function DashboardView() {
                return (
                    <div className="p-6 space-y-6">
                        <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                            <h2 className="text-xl font-bold text-slate-800">Welcome, Pastor Casey</h2>
                            <p className="text-slate-500 text-sm mt-1">Ministry Dashboard Active</p>
                        </div>
                        
                        <div className="grid grid-cols-2 gap-4">
                            <div className="bg-blue-600 p-5 rounded-2xl text-white shadow-lg shadow-blue-900/20">
                                <div className="text-3xl font-bold">3</div>
                                <div className="text-xs font-bold uppercase opacity-80 mt-1">Sermons</div>
                            </div>
                            <div className="bg-orange-500 p-5 rounded-2xl text-white shadow-lg shadow-orange-900/20">
                                <div className="text-3xl font-bold">2</div>
                                <div className="text-xs font-bold uppercase opacity-80 mt-1">Events</div>
                            </div>
                        </div>
                    </div>
                );
            }

            // --- VIEW: SERMONS (With Database Connection) ---
            function SermonManager() {
                const [sermons, setSermons] = React.useState([]);
                const [loading, setLoading] = React.useState(true);

                // Load Data
                React.useEffect(() => {
                    try {
                        const unsub = db.collection('sermons').orderBy('date', 'desc').onSnapshot(snap => {
                            const data = snap.docs.map(doc => ({id: doc.id, ...doc.data()}));
                            setSermons(data);
                            setLoading(false);
                        }, err => {
                            console.error(err);
                            setLoading(false);
                        });
                        return () => unsub();
                    } catch(e) {
                        console.error("DB Error", e);
                        setLoading(false);
                    }
                }, []);

                const handleAdd = async () => {
                    const title = prompt("New Sermon Series Title:");
                    if(!title) return;
                    try {
                        await db.collection('sermons').add({
                            title: title,
                            date: new Date().toISOString(),
                            status: 'planning'
                        });
                    } catch(e) {
                        alert("Error adding: " + e.message);
                    }
                };

                return (
                    <div className="p-6">
                        <div className="flex justify-between items-center mb-6">
                            <h2 className="text-2xl font-bold text-slate-800">Sermons</h2>
                            <button onClick={handleAdd} className="bg-slate-900 text-white p-3 rounded-full shadow-lg active:scale-90 transition-transform">
                                <IconPlus />
                            </button>
                        </div>

                        {loading && <div className="text-center text-slate-400 py-10 animate-pulse">Loading Database...</div>}
                        
                        <div className="space-y-3 pb-20">
                            {sermons.map(item => (
                                <div key={item.id} className="bg-white p-4 rounded-xl border border-slate-200 shadow-sm">
                                    <h3 className="font-bold text-slate-800">{item.title}</h3>
                                    <span className="text-xs text-slate-400 uppercase font-bold">{item.status || 'Planning'}</span>
                                </div>
                            ))}
                            {!loading && sermons.length === 0 && (
                                <div className="text-center p-8 border-2 border-dashed border-slate-300 rounded-xl text-slate-400">
                                    No sermons found. Tap + to add one.
                                </div>
                            )}
                        </div>
                    </div>
                );
            }

            // --- RENDER ---
            const root = ReactDOM.createRoot(document.getElementById('root'));
            root.render(<App />);
            
        } catch (err) {
            document.getElementById('debug-log').innerHTML = "CRITICAL FAILURE: " + err.message;
        }
    </script>
</body>
</html>
