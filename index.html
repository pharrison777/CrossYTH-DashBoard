<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>MinistryOS Pro</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#0f172a">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <style>
        body { background-color: #0f172a; color: white; -webkit-tap-highlight-color: transparent; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .safe-pb { padding-bottom: env(safe-area-inset-bottom); }
        
        /* Calendar Styles */
        .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px; }
        .cal-day { min-height: 45px; border-radius: 6px; position: relative; font-size: 11px; padding: 4px; display: flex; flex-direction: column; align-items: center; }
        .current-day { border: 1px solid #3b82f6; background: rgba(59, 130, 246, 0.1); }
        .dot { width: 6px; height: 6px; border-radius: 50%; margin-bottom: 2px; }
        
        /* Inputs */
        input, textarea, select { background: #1e293b; border: 1px solid #334155; color: white; border-radius: 8px; padding: 10px; width: 100%; outline: none; }
        input:focus, textarea:focus { border-color: #3b82f6; }
        label { font-size: 11px; text-transform: uppercase; color: #94a3b8; font-weight: bold; margin-bottom: 4px; display: block; }
    </style>
</head>
<body>

    <div id="root" class="h-screen w-screen bg-slate-900"></div>

    <script type="text/babel">
        // --- FIREBASE CONFIG ---
        const firebaseConfig = {
          apiKey: "AIzaSyCWTjZ5P-cvfL3bgFOrl53qRQEfWP35ThE",
          authDomain: "crossyth-dashboard.firebaseapp.com",
          projectId: "crossyth-dashboard",
          storageBucket: "crossyth-dashboard.firebasestorage.app",
          messagingSenderId: "999386499044",
          appId: "1:999386499044:web:49e4bc10c133b4c20f29f1"
        };
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // --- ICONS ---
        const { Calendar, MapPin, Mic2, Users, BookOpen, Plus, ChevronDown, ChevronRight, ChevronLeft, Trash2, CheckSquare, Save, X, Activity } = window.lucide;

        // --- UTILS: THE BRAIN ---
        const generateSmartWorkflow = (title, desc, dueDate) => {
            const tasks = [];
            const due = new Date(dueDate);
            const calcDate = (days) => {
                const d = new Date(due);
                d.setDate(d.getDate() - days);
                return d.toISOString().split('T')[0];
            };

            // 1. Standard Project Tasks
            tasks.push({ txt: "Concept & Budget Approval", date: calcDate(30), done: false });
            tasks.push({ txt: "Team Recruitment", date: calcDate(21), done: false });
            tasks.push({ txt: "Supplies/Materials Ordered", date: calcDate(14), done: false });

            // 2. Contextual Tasks (The AI Part)
            const text = (title + " " + desc).toLowerCase();
            
            if(text.includes('food') || text.includes('dinner') || text.includes('lunch') || text.includes('catering')) {
                tasks.push({ txt: "Finalize Menu & Caterer", date: calcDate(10), done: false });
                tasks.push({ txt: "Shop for Groceries/Supplies", date: calcDate(2), done: false });
            }
            if(text.includes('music') || text.includes('worship') || text.includes('band')) {
                tasks.push({ txt: "Confirm Band/Worship Leader", date: calcDate(20), done: false });
                tasks.push({ txt: "Send Setlist to Production", date: calcDate(5), done: false });
            }
            if(text.includes('guest') || text.includes('speaker')) {
                tasks.push({ txt: "Book Travel/Lodging for Guest", date: calcDate(25), done: false });
            }
            if(text.includes('outreach') || text.includes('community')) {
                tasks.push({ txt: "Contact Local Partners", date: calcDate(15), done: false });
                tasks.push({ txt: "Print Flyers/Handouts", date: calcDate(7), done: false });
            }

            // 3. The "2 Weeks Out" Target
            tasks.push({ txt: "TARGET COMPLETION (Dry Run)", date: calcDate(14), done: false, isTarget: true });
            tasks.push({ txt: "Final Walkthrough", date: calcDate(1), done: false });

            return tasks.sort((a,b) => a.date.localeCompare(b.date));
        };

        // --- APP CONTAINER ---
        function App() {
            const [tab, setTab] = React.useState('calendar');

            return (
                <div className="flex flex-col h-full w-full bg-slate-900 text-white safe-pb">
                    
                    {/* HEADER */}
                    <div className="h-16 flex items-center justify-between px-4 bg-slate-900 border-b border-slate-800 z-10 shrink-0">
                        <div>
                            <span className="font-bold text-lg tracking-tight text-white block leading-none">
                                {tab === 'calendar' ? 'Master Calendar' : 
                                 tab === 'benson' ? 'Benson Campus' :
                                 tab === 'prod' ? 'Production' :
                                 tab === 'crossyth' ? 'CrossYTH' : 'CrossLink'}
                            </span>
                            <span className="text-[10px] text-slate-500 uppercase tracking-widest font-bold">MinistryOS</span>
                        </div>
                        <div className="w-9 h-9 bg-slate-800 rounded-full flex items-center justify-center text-xs font-bold text-slate-400 border border-slate-700">PC</div>
                    </div>

                    {/* CONTENT AREA */}
                    <div className="flex-1 overflow-y-auto bg-slate-950 relative">
                        {tab === 'calendar' && <CalendarView />}
                        {tab === 'benson' && <GenericManager category="Benson" color="red" />}
                        {tab === 'prod' && <ProductionManager />}
                        {tab === 'crossyth' && <UnifiedManager category="CrossYTH" color="blue" />}
                        {tab === 'crosslink' && <UnifiedManager category="CrossLink" color="purple" />}
                    </div>

                    {/* BOTTOM NAV */}
                    <div className="h-20 bg-slate-900 border-t border-slate-800 flex justify-around items-start pt-3 text-[10px] shrink-0 safe-pb">
                        <NavBtn id="calendar" icon={Calendar} label="Calendar" active={tab} set={setTab} />
                        <NavBtn id="benson" icon={MapPin} label="Benson" active={tab} set={setTab} />
                        <NavBtn id="prod" icon={Mic2} label="Prod" active={tab} set={setTab} />
                        <NavBtn id="crossyth" icon={Users} label="YTH" active={tab} set={setTab} />
                        <NavBtn id="crosslink" icon={BookOpen} label="Link" active={tab} set={setTab} />
                    </div>
                </div>
            );
        }

        // --- 1. CALENDAR VIEW ---
        function CalendarView() {
            const [date, setDate] = React.useState(new Date());
            const [items, setItems] = React.useState([]);

            // Fetch ALL items with dates
            React.useEffect(() => {
                const unsub1 = db.collection('projects').onSnapshot(snap => {
                    const projs = snap.docs.map(d => ({...d.data(), type: 'project'}));
                    // Also fetch series/sermons if needed, for now using projects/events structure
                    setItems(prev => [...projs]); 
                });
                return () => unsub1();
            }, []);

            const daysInMonth = new Date(date.getFullYear(), date.getMonth() + 1, 0).getDate();
            const firstDay = new Date(date.getFullYear(), date.getMonth(), 1).getDay();
            const monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];

            const getItemsForDay = (day) => {
                const dateStr = new Date(date.getFullYear(), date.getMonth(), day).toISOString().split('T')[0];
                return items.filter(i => i.dueDate === dateStr || i.date === dateStr);
            };

            const getColor = (cat, status) => {
                if(status === 'Pending') return 'bg-gray-600'; // Ideas are gray
                if(cat === 'Benson') return 'bg-red-500';
                if(cat === 'Production') return 'bg-yellow-500';
                if(cat === 'CrossYTH') return 'bg-blue-500';
                if(cat === 'CrossLink') return 'bg-purple-500';
                return 'bg-white';
            };

            return (
                <div className="p-4">
                    <div className="flex justify-between items-center mb-6">
                        <button onClick={() => setDate(new Date(date.setMonth(date.getMonth()-1)))} className="p-2 bg-slate-800 rounded-lg"><ChevronLeft size={20}/></button>
                        <h2 className="text-xl font-bold">{monthNames[date.getMonth()]} {date.getFullYear()}</h2>
                        <button onClick={() => setDate(new Date(date.setMonth(date.getMonth()+1)))} className="p-2 bg-slate-800 rounded-lg"><ChevronRight size={20}/></button>
                    </div>

                    <div className="cal-grid mb-6">
                        {['S','M','T','W','T','F','S'].map(d => <div key={d} className="text-center text-slate-500 text-[10px] font-bold py-2">{d}</div>)}
                        {Array(firstDay).fill(null).map((_,i) => <div key={`e-${i}`} />)}
                        {Array(daysInMonth).fill(null).map((_,i) => {
                            const dayItems = getItemsForDay(i+1);
                            const isToday = new Date().toDateString() === new Date(date.getFullYear(), date.getMonth(), i+1).toDateString();
                            return (
                                <div key={i} className={`cal-day ${dayItems.length ? 'bg-slate-800' : 'bg-slate-900'} ${isToday ? 'current-day' : ''}`}>
                                    <span className={isToday ? 'text-blue-400 font-bold' : 'text-slate-400'}>{i+1}</span>
                                    <div className="flex flex-wrap gap-1 justify-center mt-1">
                                        {dayItems.map((item, idx) => (
                                            <div key={idx} className={`dot ${getColor(item.category, item.status)}`} />
                                        ))}
                                    </div>
                                </div>
                            )
                        })}
                    </div>

                    {/* Agenda */}
                    <div className="space-y-2">
                        <h3 className="text-xs font-bold text-slate-500 uppercase tracking-widest mb-2">Upcoming Schedule</h3>
                        {items
                            .filter(i => new Date(i.dueDate || i.date) >= new Date())
                            .sort((a,b) => (a.dueDate||a.date).localeCompare(b.dueDate||b.date))
                            .slice(0, 5)
                            .map((item, i) => (
                            <div key={i} className="flex items-center gap-3 bg-slate-900 border border-slate-800 p-3 rounded-xl">
                                <div className={`w-2 h-10 rounded-full ${getColor(item.category, item.status)}`}></div>
                                <div>
                                    <div className="font-bold text-sm">{item.title}</div>
                                    <div className="text-xs text-slate-500">{(item.dueDate || item.date)} â€¢ {item.status}</div>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        // --- 2. GENERIC MANAGER (Benson Projects/Events/Outreach) ---
        function GenericManager({ category, color }) {
            const [subTab, setSubTab] = React.useState('Projects'); // Projects, Events, Outreach
            
            return (
                <div className="p-4 h-full flex flex-col">
                    <div className="flex bg-slate-900 p-1 rounded-xl mb-4 shrink-0">
                        {['Projects', 'Events', 'Outreach'].map(t => (
                            <button key={t} onClick={() => setSubTab(t)} className={`flex-1 py-2 text-xs font-bold rounded-lg transition-all ${subTab===t ? 'bg-slate-700 text-white' : 'text-slate-500'}`}>
                                {t}
                            </button>
                        ))}
                    </div>
                    <WorkflowSystem category={category} subCategory={subTab} color={color} />
                </div>
            );
        }

        // --- 3. UNIFIED MANAGER (For CrossYTH / CrossLink) ---
        // Combines Teaching Series with Projects/Events
        function UnifiedManager({ category, color }) {
            const [subTab, setSubTab] = React.useState('Series');
            
            return (
                <div className="p-4 h-full flex flex-col">
                    <div className="flex bg-slate-900 p-1 rounded-xl mb-4 shrink-0 overflow-x-auto">
                        {['Series', 'Projects', 'Events', 'Outreach'].map(t => (
                            <button key={t} onClick={() => setSubTab(t)} className={`flex-1 py-2 px-2 text-xs font-bold rounded-lg whitespace-nowrap transition-all ${subTab===t ? 'bg-slate-700 text-white' : 'text-slate-500'}`}>
                                {t}
                            </button>
                        ))}
                    </div>

                    {subTab === 'Series' ? (
                        <SeriesManager category={category} color={color} />
                    ) : (
                        <WorkflowSystem category={category} subCategory={subTab} color={color} />
                    )}
                </div>
            );
        }

        // --- 4. PRODUCTION MANAGER ---
        function ProductionManager() {
            const [subTab, setSubTab] = React.useState('Weekly');
            
            return (
                <div className="p-4 h-full flex flex-col">
                    <div className="flex bg-slate-900 p-1 rounded-xl mb-4 shrink-0">
                        {['Weekly', 'Projects'].map(t => (
                            <button key={t} onClick={() => setSubTab(t)} className={`flex-1 py-2 text-xs font-bold rounded-lg transition-all ${subTab===t ? 'bg-slate-700 text-white' : 'text-slate-500'}`}>
                                {t}
                            </button>
                        ))}
                    </div>

                    {subTab === 'Weekly' ? <WeeklyChecklist /> : <WorkflowSystem category="Production" subCategory="Projects" color="yellow" />}
                </div>
            );
        }

        // --- CORE: WORKFLOW SYSTEM (The Brain) ---
        function WorkflowSystem({ category, subCategory, color }) {
            const [mode, setMode] = React.useState('Ideas'); // Ideas vs Active
            const [items, setItems] = React.useState([]);
            const [isAdding, setIsAdding] = React.useState(false);

            // Form State
            const [newTitle, setNewTitle] = React.useState('');
            const [newDesc, setNewDesc] = React.useState('');
            const [newDate, setNewDate] = React.useState('');

            React.useEffect(() => {
                const q = db.collection('projects')
                    .where('category', '==', category)
                    .where('subCategory', '==', subCategory)
                    .where('status', '==', mode === 'Ideas' ? 'Pending' : 'Approved');
                
                const unsub = q.onSnapshot(snap => {
                    setItems(snap.docs.map(d => ({id: d.id, ...d.data()})));
                });
                return () => unsub();
            }, [category, subCategory, mode]);

            const handleSave = async () => {
                if(!newTitle || !newDate) return alert("Title and Date required");
                await db.collection('projects').add({
                    category, subCategory, 
                    title: newTitle, desc: newDesc, dueDate: newDate,
                    status: 'Pending', tasks: []
                });
                setIsAdding(false); setNewTitle(''); setNewDesc(''); setNewDate('');
            };

            const approve = async (item) => {
                const tasks = generateSmartWorkflow(item.title, item.desc, item.dueDate);
                await db.collection('projects').doc(item.id).update({
                    status: 'Approved',
                    tasks: tasks
                });
            };

            return (
                <div className="flex-1 flex flex-col">
                    {/* Toggle Ideas/Active */}
                    <div className="flex justify-between items-center mb-4">
                        <div className="flex gap-4">
                            <button onClick={()=>setMode('Ideas')} className={`text-sm font-bold ${mode==='Ideas' ? 'text-white border-b-2 border-white' : 'text-slate-500'}`}>IDEAS</button>
                            <button onClick={()=>setMode('Active')} className={`text-sm font-bold ${mode==='Active' ? 'text-white border-b-2 border-white' : 'text-slate-500'}`}>ACTIVE</button>
                        </div>
                        {mode === 'Ideas' && <button onClick={()=>setIsAdding(true)} className={`text-${color}-500`}><Plus size={24}/></button>}
                    </div>

                    {/* Add Form */}
                    {isAdding && (
                        <div className="bg-slate-800 p-4 rounded-xl mb-4 border border-slate-700 animate-pulse-once">
                            <div className="space-y-3">
                                <div><label>Title</label><input value={newTitle} onChange={e=>setNewTitle(e.target.value)} placeholder="Project Name" /></div>
                                <div><label>Description</label><textarea value={newDesc} onChange={e=>setNewDesc(e.target.value)} placeholder="Details (triggers AI)" rows="3"></textarea></div>
                                <div><label>Due Date</label><input type="date" value={newDate} onChange={e=>setNewDate(e.target.value)} /></div>
                                <div className="flex gap-2 pt-2">
                                    <button onClick={handleSave} className={`flex-1 bg-${color}-600 py-2 rounded font-bold`}>Save Idea</button>
                                    <button onClick={()=>setIsAdding(false)} className="px-4 py-2 bg-slate-700 rounded">Cancel</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* List */}
                    <div className="space-y-3 overflow-y-auto pb-20">
                        {items.length === 0 && <div className="text-center text-slate-500 py-10 italic">No {mode} items found.</div>}
                        
                        {items.map(item => (
                            <WorkflowCard key={item.id} item={item} mode={mode} onApprove={()=>approve(item)} color={color} />
                        ))}
                    </div>
                </div>
            );
        }

        // --- SUB-COMPONENT: WORKFLOW CARD (With Accordion) ---
        function WorkflowCard({ item, mode, onApprove, color }) {
            const [expanded, setExpanded] = React.useState(false);

            return (
                <div className={`bg-slate-900 border border-slate-800 rounded-xl overflow-hidden transition-all`}>
                    <div className="p-4" onClick={() => mode === 'Active' && setExpanded(!expanded)}>
                        <div className="flex justify-between items-start">
                            <div>
                                <h3 className="font-bold text-lg text-white">{item.title}</h3>
                                <p className="text-sm text-slate-400 mt-1">{item.desc}</p>
                                <div className="flex items-center gap-2 mt-2">
                                    <span className="text-[10px] bg-slate-800 px-2 py-1 rounded text-slate-300 border border-slate-700">Due: {item.dueDate}</span>
                                    {mode === 'Active' && <span className="text-[10px] text-blue-400 font-bold flex items-center gap-1">{expanded ? 'Hide Tasks' : 'Show Tasks'} {expanded ? <ChevronDown size={12}/> : <ChevronRight size={12}/>}</span>}
                                </div>
                            </div>
                            {mode === 'Ideas' ? (
                                <button onClick={(e) => {e.stopPropagation(); onApprove();}} className="bg-emerald-600 text-white text-xs font-bold px-3 py-1.5 rounded shadow-lg hover:bg-emerald-500">
                                    APPROVE
                                </button>
                            ) : (
                                <div className={`w-2 h-2 rounded-full bg-${color}-500 shadow-[0_0_8px_currentColor]`}></div>
                            )}
                        </div>
                    </div>

                    {/* EXPANDED TASK LIST (The Tree) */}
                    {expanded && mode === 'Active' && (
                        <div className="bg-slate-950/50 border-t border-slate-800 p-4 space-y-3">
                            <div className="text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-2">AI Generated Workflow</div>
                            {item.tasks && item.tasks.map((t, i) => (
                                <div key={i} className="flex items-start gap-3 text-sm group">
                                    <div className={`mt-0.5 w-4 h-4 rounded border flex items-center justify-center shrink-0 ${t.done ? 'bg-blue-600 border-blue-600' : 'border-slate-600'}`}>
                                        {t.done && <CheckSquare size={10} />}
                                    </div>
                                    <div className="flex-1">
                                        <div className={`${t.isTarget ? 'text-emerald-400 font-bold' : 'text-slate-300'} ${t.done ? 'line-through opacity-50' : ''}`}>{t.txt}</div>
                                        <div className="text-[10px] text-slate-500">Target: {t.date}</div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        }

        // --- COMPONENT: SERIES MANAGER (Teaching) ---
        function SeriesManager({ category, color }) {
            const [seriesList, setSeriesList] = React.useState([]);
            const [expandedSeries, setExpandedSeries] = React.useState(null);
            const [isAdding, setIsAdding] = React.useState(false);

            // New Series State
            const [sTitle, setSTitle] = React.useState('');
            const [sWeeks, setSWeeks] = React.useState('');

            React.useEffect(() => {
                const unsub = db.collection('series').where('category', '==', category).onSnapshot(snap => {
                    setSeriesList(snap.docs.map(d => ({id: d.id, ...d.data()})));
                });
                return () => unsub();
            }, [category]);

            const saveSeries = async () => {
                if(!sTitle) return;
                await db.collection('series').add({ category, title: sTitle, weeks: sWeeks, created: new Date().toISOString() });
                setIsAdding(false); setSTitle(''); setSWeeks('');
            };

            return (
                <div className="flex-1 overflow-y-auto pb-20">
                    <div className="flex justify-between items-center mb-4">
                        <h3 className="font-bold text-slate-400 uppercase text-xs tracking-widest">Sermon Series</h3>
                        <button onClick={()=>setIsAdding(true)} className={`text-${color}-500`}><Plus/></button>
                    </div>

                    {isAdding && (
                        <div className="bg-slate-800 p-4 rounded-xl mb-4 border border-slate-700">
                            <label>Series Title</label><input value={sTitle} onChange={e=>setSTitle(e.target.value)} className="mb-2" />
                            <label>Number of Weeks</label><input type="number" value={sWeeks} onChange={e=>setSWeeks(e.target.value)} className="mb-2" />
                            <button onClick={saveSeries} className={`bg-${color}-600 w-full py-2 rounded font-bold`}>Create Series</button>
                        </div>
                    )}

                    <div className="space-y-3">
                        {seriesList.map(series => (
                            <div key={series.id} className="bg-slate-900 border border-slate-800 rounded-xl overflow-hidden">
                                <div className="p-4 flex justify-between items-center" onClick={() => setExpandedSeries(expandedSeries === series.id ? null : series.id)}>
                                    <div>
                                        <h3 className="font-bold text-lg">{series.title}</h3>
                                        <p className="text-xs text-slate-500">{series.weeks} Weeks</p>
                                    </div>
                                    <ChevronDown size={16} className={`transition-transform ${expandedSeries===series.id ? 'rotate-180' : ''}`} />
                                </div>
                                {expandedSeries === series.id && <SermonList seriesId={series.id} color={color} />}
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        // --- SUB-COMPONENT: SERMON LIST (Inside Series) ---
        function SermonList({ seriesId, color }) {
            const [sermons, setSermons] = React.useState([]);
            const [editMode, setEditMode] = React.useState(false);
            
            // New Sermon Data
            const [title, setTitle] = React.useState('');
            const [speaker, setSpeaker] = React.useState('');
            const [scripture, setScripture] = React.useState('');
            const [notes, setNotes] = React.useState('');

            React.useEffect(() => {
                const unsub = db.collection('sermons').where('seriesId', '==', seriesId).orderBy('weekNum').onSnapshot(snap => {
                    setSermons(snap.docs.map(d => ({id: d.id, ...d.data()})));
                });
                return () => unsub();
            }, [seriesId]);

            const addSermon = async () => {
                await db.collection('sermons').add({
                    seriesId, title, speaker, scripture, notes, 
                    weekNum: sermons.length + 1
                });
                setEditMode(false); setTitle(''); setSpeaker(''); setScripture(''); setNotes('');
            };

            return (
                <div className="bg-slate-950 p-4 border-t border-slate-800">
                    {sermons.map(s => (
                        <div key={s.id} className="mb-4 pb-4 border-b border-slate-800 last:border-0">
                            <div className="flex justify-between">
                                <span className={`text-${color}-400 text-xs font-bold uppercase`}>Week {s.weekNum}</span>
                                <span className="text-xs text-slate-500">{s.speaker}</span>
                            </div>
                            <h4 className="font-bold text-white text-md">{s.title}</h4>
                            <p className="text-xs text-slate-400 italic mb-2">{s.scripture}</p>
                            {s.notes && <div className="text-xs text-slate-300 bg-slate-900 p-2 rounded">{s.notes}</div>}
                        </div>
                    ))}

                    {editMode ? (
                        <div className="space-y-2 mt-4 bg-slate-900 p-3 rounded border border-slate-700">
                            <input placeholder="Sermon Title" value={title} onChange={e=>setTitle(e.target.value)} />
                            <input placeholder="Speaker" value={speaker} onChange={e=>setSpeaker(e.target.value)} />
                            <input placeholder="Scripture" value={scripture} onChange={e=>setScripture(e.target.value)} />
                            <textarea placeholder="Notes/Apologetics..." value={notes} onChange={e=>setNotes(e.target.value)} rows="3" />
                            <button onClick={addSermon} className={`bg-${color}-600 w-full py-2 rounded text-sm font-bold`}>Save Sermon</button>
                        </div>
                    ) : (
                        <button onClick={()=>setEditMode(true)} className="w-full py-2 border border-dashed border-slate-700 text-slate-500 text-xs rounded mt-2 hover:bg-slate-900">
                            + Add Week {sermons.length + 1}
                        </button>
                    )}
                </div>
            );
        }

        // --- 5. WEEKLY CHECKLIST (Production) ---
        function WeeklyChecklist() {
            const [tasks, setTasks] = React.useState([]);
            const [isAdding, setIsAdding] = React.useState(false);
            const [newMain, setNewMain] = React.useState('');

            React.useEffect(() => {
                const unsub = db.collection('prod_weekly').onSnapshot(snap => {
                    setTasks(snap.docs.map(d => ({id: d.id, ...d.data()})));
                });
                return () => unsub();
            }, []);

            const addMain = async () => {
                if(!newMain) return;
                await db.collection('prod_weekly').add({ title: newMain, subtasks: [] });
                setNewMain(''); setIsAdding(false);
            };

            const addSub = async (taskId, currentSubs) => {
                const txt = prompt("New Subtask:");
                if(!txt) return;
                const updated = [...(currentSubs||[]), { txt, done: false }];
                await db.collection('prod_weekly').doc(taskId).update({ subtasks: updated });
            };

            const toggleSub = async (taskId, subIndex, currentSubs) => {
                const updated = [...currentSubs];
                updated[subIndex].done = !updated[subIndex].done;
                await db.collection('prod_weekly').doc(taskId).update({ subtasks: updated });
            };

            const deleteMain = async (id) => {
                if(confirm("Delete this checklist?")) await db.collection('prod_weekly').doc(id).delete();
            };

            return (
                <div className="flex-1 overflow-y-auto pb-20">
                    <div className="flex justify-between items-center mb-4">
                        <h3 className="font-bold text-yellow-500 uppercase text-xs tracking-widest">Weekly Checklists</h3>
                        <button onClick={()=>setIsAdding(true)} className="text-yellow-500"><Plus/></button>
                    </div>

                    {isAdding && (
                        <div className="flex gap-2 mb-4">
                            <input value={newMain} onChange={e=>setNewMain(e.target.value)} placeholder="Main Task Name (e.g. Audio Setup)" />
                            <button onClick={addMain} className="bg-yellow-600 px-4 rounded font-bold">Add</button>
                        </div>
                    )}

                    <div className="space-y-4">
                        {tasks.map(task => (
                            <div key={task.id} className="bg-slate-900 border border-slate-800 rounded-xl p-4">
                                <div className="flex justify-between items-center mb-3 border-b border-slate-800 pb-2">
                                    <h4 className="font-bold text-white">{task.title}</h4>
                                    <div className="flex gap-2">
                                        <button onClick={()=>addSub(task.id, task.subtasks)} className="text-blue-400 text-xs">+ Sub</button>
                                        <button onClick={()=>deleteMain(task.id)} className="text-red-400"><Trash2 size={14}/></button>
                                    </div>
                                </div>
                                <div className="space-y-2">
                                    {(task.subtasks || []).map((sub, idx) => (
                                        <div key={idx} className="flex items-center gap-3 cursor-pointer" onClick={()=>toggleSub(task.id, idx, task.subtasks)}>
                                            <div className={`w-4 h-4 rounded border flex items-center justify-center ${sub.done ? 'bg-yellow-500 border-yellow-500' : 'border-slate-600'}`}>
                                                {sub.done && <CheckSquare size={10} className="text-black" />}
                                            </div>
                                            <span className={`text-sm ${sub.done ? 'line-through text-slate-500' : 'text-slate-300'}`}>{sub.txt}</span>
                                        </div>
                                    ))}
                                    {(!task.subtasks || task.subtasks.length === 0) && <div className="text-xs text-slate-600 italic">No subtasks yet</div>}
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        // --- HELPER NAV BTN ---
        const NavBtn = ({ id, icon: Icon, label, active, set }) => (
            <button onClick={() => set(id)} className={`flex flex-col items-center gap-1 transition-all ${active === id ? 'text-blue-400 scale-110' : 'text-slate-500'}`}>
                <Icon size={20} strokeWidth={active===id?3:2} />
                <span>{label}</span>
            </button>
        );

        // --- RENDER ---
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
